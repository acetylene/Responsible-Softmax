\renewcommand{\thesubsection}{\Alph{subsection}}

\chapter{Dynamic Responsibility Code}\label{app:DRcode}
\section{Implementation of Responsibility Map}\label{code:map}
Below gives an implementation of the responsibility map from equation \eqref{map} in MATLAB \cite{MATLAB:2020a}. All code in the appendices is written for MATLAB, more information may be found at the personal website \url{https://www.math.arizona.edu/~rcoatney}.

\lstinputlisting[title = simplex\_map.m,
			     lastline = 32]{
			     	../../../Code/MATLAB/simplex_map.m
		     	}

\newpage
\section{Implementation of Algorithm \ref{ratioAlg}}\label{code:ratioAlg}
Algorithm \ref{ratioAlg} iterates the responsibility map until convergence.  Here the stopping point is determined by a given absolute tolerance.  This may need to change for large $K$.
\lstinputlisting[title = stablepoint.m,
				 lastline = 51]{
				 	../../../Code/MATLAB/stablepoint.m
			 	}

\newpage
\section{Implementation of Algorithm \ref{newtAlg}}\label{code:newtAlg}
The code here is only ever called through the file \verb|stablepoint.m| with `newton' as the method option. 
\lstinputlisting[title = stablepointNewton.m]{
					../../../Code/MATLAB/stablepointNewton.m
				}

The function \verb|lDifferentials| called by \verb|stablepointNewton| calculates the gradient and Hessian of \( \elpi{F} \) with respect to \( \bm\pi \) at the point \verb|newp|.
\lstinputlisting[title = lDifferentials.m]{
				 	../../../Code/MATLAB/lDifferentials.m
			 	}
			
%\newpage
\section{Code for Experiments on Convergence}
The script \verb|error_samples| calculates \( \hat{\bm \pi}_F \) for \( F \) calculated from several samples of Gaussian mixture data. It uses the helper function \verb|GMMData.m| to generate Gaussian mixture data via PRNG.

\lstinputlisting[title = error\_samples.m]{
	../../../Code/MATLAB/error_samples.m
}

\newpage
\lstinputlisting[title = GMMData.m]{
	../../../Code/MATLAB/GMMData.m
}

\chapter{Responsible Softmax Code}\label{app:RScode}
\section{Responsible Softmax Layer}\label{code:RSlayer}
%alternate input range 39,50-52,55-

\lstinputlisting[title = responsibilityLoss.m, linerange = {1-81,122-192} ]{
	../../../Code/MATLAB/NNlayers/responsibilityLoss.m 
}

\lstinputlisting[title = responsibilityOperator.m ]{
	../../../Code/MATLAB/NNlayers/objects/responsibilityOperator.m 
}

\lstinputlisting[title = tolCheckerEuc.m ]{
	../../../Code/MATLAB/NNlayers/objects/tolCheckerEuc.m 
}

\section{Fixed Responsible Softmax layer}\label{code:fixedRSLayer}
\lstinputlisting[title = fixedRespLoss.m ]{
	../../../Code/MATLAB/NNlayers/fixedRespLoss.m
}


\chapter{Code for Examples on GMM Data}\label{app:GMMexample}

\lstinputlisting[title = GMMoverlap.m  ]{
	../../../Code/MATLAB/NNlayers/GMMoverlap.m 
}
\lstinputlisting[title = test\_nets.m ]{
	../../../Code/MATLAB/NNlayers/test_nets.m
}
\lstinputlisting[title = train\_nets.m ]{
	../../../Code/MATLAB/NNlayers/train_nets.m
}


\chapter{Code for Example on MNIST Data}\label{app:MNISTexample}

\lstinputlisting[title = respMNISTimba.m  ]{
	../../../Code/MATLAB/NNlayers/respMNISTimba.m
}
\lstinputlisting[title = unbalanced\_MNIST.m ]{
	../../../Code/MATLAB/MNIST/unbalanced_MNIST.m
}

\begin{verbatim}


\end{verbatim}